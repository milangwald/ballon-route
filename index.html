<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leaflet + Earth Engine ‚Äì Strecke farbig</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Earth Engine JS API -->
  <script src="https://cdn.jsdelivr.net/npm/@google/earthengine@1.7.10/build/ee_api_js.js"></script>

  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 24px; }
    button, select { padding: 10px 14px; font-size: 16px; cursor: pointer; }
    button[disabled] { opacity: 0.6; cursor: not-allowed; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    #log { white-space: pre-wrap; background: #f6f6f6; padding: 12px; border-radius: 8px; margin-top: 12px; }
    #map { height: 520px; margin-top: 16px; border-radius: 8px; }
    .pill { padding: 4px 10px; border-radius: 999px; background: #eee; font-size: 13px; }
  </style>
</head>

<body>
  <h1>Leaflet + Earth Engine ‚Äì Strecke farbig</h1>

  <div class="row">
    <button id="btnLogin">Mit Google anmelden (Popup)</button>

    <label class="pill" for="mode">F√§rben nach:</label>
    <select id="mode" disabled>
      <option value="t">Zeit</option>
      <option value="h">H√∂he</option>
      <option value="p">Druck</option>
      <option value="l">Luftfeuchtigkeit</option>
    </select>

    <button id="btnRender" disabled>Strecke zeichnen</button>
  </div>

  <div id="log"></div>
  <div id="map"></div>

  <script>
    // ============
    // Logging/UI
    // ============
    const btn = document.getElementById("btnLogin");
    const btnRender = document.getElementById("btnRender");
    const modeSel = document.getElementById("mode");
    const logEl = document.getElementById("log");

    function log(m) { console.log(m); logEl.textContent += m + "\n"; }

    let authBusy = false;
    let authFinished = false;

    function setBusy(b) {
      authBusy = b;
      btn.disabled = b;
      btn.textContent = b ? "Login l√§uft ‚Ä¶ (Popup pr√ºfen)" : "Mit Google anmelden (Popup)";
    }

    // ============
    // Leaflet setup
    // ============
    let map = null;
    let routeGroup = null;

    function ensureMap() {
      if (map) return;
      map = L.map("map").setView([51.1657, 10.4515], 6);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "¬© OpenStreetMap contributors",
        maxZoom: 19
      }).addTo(map);

      routeGroup = L.layerGroup().addTo(map);
      log("üó∫Ô∏è Karte initialisiert.");
    }

    function clearRouteLayers() {
      if (routeGroup) routeGroup.clearLayers();
    }

    // ============
    // Deine Daten (aus dem oberen Code)
    // ============
    // Achtung: koordinaten sind [lon, lat] ‚Äì Leaflet braucht [lat, lon]
    const koordinaten = [
      [6.9749162, 51.3242108],
      [6.9749441, 51.3241885],
      [6.9749542, 51.3241784],
      [6.9749748, 51.3241598],
      [6.9750193, 51.3241581],
      [6.9750443, 51.3241134],
      [6.9750775, 51.3240951],
      [6.9750948, 51.3240880],
      [6.9751323, 51.3240812],
      [6.9751497, 51.3240687],
      [6.9752061, 51.3240930],
      [6.9752391, 51.3240778],
      [6.9752681, 51.3240453],
      [6.9753124, 51.3240193],
      [6.9753729, 51.3240057],
      [6.9753992, 51.3240066],
      [6.9754246, 51.3240102],
      [6.9754550, 51.3240223],
      [6.9754899, 51.3240411],
      [6.9755205, 51.3240588],
      [6.9755577, 51.3240699],
      [6.9755871, 51.3240794],
      [6.9756216, 51.3240947],
      [6.9756441, 51.3241111],
      [6.9756711, 51.3241226],
      [6.9756964, 51.3241391],
      [6.9757261, 51.3241573],
      [6.9757547, 51.3241692],
      [6.9757796, 51.3241780],
      [6.9758088, 51.3241917],
      [6.9758487, 51.3241974],
      [6.9758855, 51.3242047],
      [6.9759164, 51.3242224],
      [6.9759491, 51.3242375],
      [6.9759893, 51.3242483],
      [6.9760241, 51.3242576],
      [6.9760590, 51.3242667],
      [6.9761001, 51.3242783],
      [6.9761382, 51.3242880],
      [6.9761652, 51.3242971],
      [6.9762003, 51.3243050],
      [6.9762344, 51.3243142],
      [6.9762706, 51.3243166],
      [6.9763102, 51.3243202],
      [6.9763355, 51.3243277],
      [6.9763533, 51.3243318],
      [6.9763843, 51.3243402],
      [6.9764191, 51.3243500],
      [6.9764450, 51.3243616],
      [6.9764704, 51.3243699],
      [6.9764945, 51.3243758],
      [6.9765277, 51.3243843],
      [6.9765579, 51.3243865],
      [6.9765918, 51.3243916],
      [6.9766269, 51.3244030],
      [6.9766545, 51.3244088],
      [6.9766805, 51.3244106],
      [6.9767109, 51.3244214],
      [6.9767435, 51.3244368],
      [6.9767564, 51.3244611],
      [6.9767625, 51.3244879],
      [6.9767786, 51.3245100],
      [6.9768020, 51.3245328],
      [6.9768331, 51.3245499],
      [6.9768790, 51.3245669],
      [6.9769066, 51.3245870],
      [6.9769445, 51.3246115],
      [6.9769820, 51.3246232],
      [6.9770063, 51.3246261],
      [6.9770374, 51.3246401],
      [6.9770705, 51.3246558],
      [6.9771115, 51.3246725],
      [6.9771184, 51.3246938],
      [6.9771574, 51.3247118],
      [6.9771798, 51.3247343],
      [6.9771972, 51.3247409],
      [6.9772331, 51.3247520],
      [6.9772718, 51.3247762],
      [6.9773012, 51.3247709],
      [6.9773354, 51.3247744],
      [6.9773601, 51.3247580],
      [6.9773864, 51.3247444],
      [6.9773949, 51.3247290],
      [6.9774044, 51.3246967],
      [6.9774152, 51.3246971],
      [6.9774288, 51.3246826],
      [6.9774466, 51.3246766],
      [6.9774658, 51.3246668],
      [6.9774754, 51.3246396],
      [6.9774519, 51.3245732],
      [6.9774672, 51.3245519],
      [6.9774779, 51.3245480],
      [6.9775044, 51.3245403],
      [6.9775216, 51.3245154],
      [6.9775362, 51.3244862],
      [6.9775431, 51.3244455],
      [6.9775353, 51.3243969],
      [6.9775444, 51.3243657],
      [6.9775618, 51.3243506],
      [6.9775885, 51.3243403],
      [6.9776042, 51.3243164],
      [6.9776430, 51.3243232],
      [6.9776644, 51.3243024],
      [6.9776733, 51.3242796],
      [6.9776863, 51.3242747],
      [6.9777214, 51.3242674],
      [6.9777370, 51.3242420],
      [6.9777639, 51.3242261],
      [6.9778037, 51.3242223],
      [6.9778323, 51.3242126],
      [6.9778165, 51.3242082],
      [6.9778434, 51.3242015],
      [6.9778836, 51.3241944],
      [6.9778986, 51.3241739],
      [6.9779254, 51.3241864],
      [6.9779536, 51.3241840],
      [6.9779969, 51.3241731],
      [6.9780376, 51.3241390],
      [6.9780898, 51.3241391],
      [6.9781168, 51.3241104],
      [6.9781443, 51.3241005],
      [6.9781956, 51.3240854],
      [6.9782099, 51.3240778],
      [6.9782754, 51.3240776],
      [6.9783194, 51.3240639],
      [6.9783640, 51.3240551],
      [6.9783859, 51.3240466],
      [6.9784341, 51.3240395],
      [6.9784766, 51.3240370],
      [6.9785168, 51.3240193],
      [6.9785480, 51.3240090],
      [6.9785855, 51.3239936],
      [6.9786133, 51.3239859],
      [6.9786507, 51.3239883],
      [6.9786511, 51.3239759],
      [6.9786970, 51.3239891],
      [6.9787337, 51.3239864],
      [6.9787641, 51.3239607],
      [6.9788173, 51.3239457],
      [6.9788591, 51.3239487],
      [6.9788809, 51.3239420],
      [6.9789105, 51.3239275],
      [6.9789159, 51.3238696],
      [6.9789651, 51.3238547],
      [6.9789966, 51.3238357],
      [6.9790421, 51.3238241],
      [6.9790821, 51.3238296],
      [6.9791127, 51.3238222],
      [6.9791448, 51.3238176],
      [6.9791670, 51.3238143],
      [6.9791965, 51.3237984],
      [6.9792502, 51.3237707],
      [6.9792836, 51.3237536],
      [6.9793117, 51.3237696],
      [6.9793519, 51.3237627],
      [6.9793887, 51.3237438],
      [6.9794242, 51.3237373],
      [6.9794615, 51.3237226],
      [6.9794942, 51.3237134],
      [6.9795221, 51.3237039],
      [6.9795508, 51.3236875],
      [6.9795939, 51.3236838],
      [6.9796277, 51.3236674],
      [6.9796608, 51.3236603],
      [6.9796911, 51.3236484],
      [6.9797228, 51.3236356],
      [6.9797529, 51.3236175],
      [6.9797877, 51.3236190],
      [6.9798178, 51.3236036],
      [6.9798476, 51.3236002],
      [6.9798906, 51.3235881],
      [6.9799242, 51.3235789],
      [6.9799562, 51.3235726],
      [6.9799867, 51.3235801],
      [6.9800293, 51.3235862],
      [6.9800588, 51.3235709],
      [6.9800782, 51.3235377],
      [6.9800977, 51.3235098],
      [6.9801229, 51.3235020],
      [6.9801358, 51.3234910],
      [6.9801675, 51.3234820],
      [6.9801976, 51.3234739],
      [6.9802249, 51.3234611],
      [6.9802540, 51.3234713],
      [6.9802809, 51.3234666],
      [6.9803087, 51.3234573],
      [6.9803366, 51.3234399],
      [6.9803677, 51.3234305],
      [6.9804107, 51.3234301],
      [6.9804170, 51.3234319],
      [6.9804652, 51.3234190],
      [6.9804895, 51.3234208],
      [6.9805129, 51.3233965],
      [6.9805421, 51.3233967],
      [6.9805625, 51.3233510],
      [6.9805967, 51.3233367],
      [6.9806302, 51.3233221],
      [6.9806682, 51.3233169],
      [6.9807001, 51.3233212],
      [6.9807101, 51.3233030],
      [6.9807563, 51.3233018],
      [6.9807914, 51.3232915],
      [6.9808415, 51.3233159],
      [6.9808694, 51.3232805],
      [6.9809074, 51.3232689],
      [6.9809479, 51.3232694],
      [6.9809890, 51.3232562],
      [6.9810379, 51.3232538],
      [6.9810733, 51.3232534],
      [6.9811093, 51.3232234],
      [6.9811414, 51.3232138],
      [6.9811645, 51.3232028],
      [6.9812044, 51.3231958],
      [6.9812402, 51.3231907],
      [6.9812801, 51.3231736],
      [6.9812760, 51.3231871],
      [6.9813105, 51.3231851],
      [6.9813592, 51.3231982],
      [6.9813549, 51.3232040],
      [6.9814002, 51.3231810],
      [6.9814394, 51.3231508],
      [6.9814949, 51.3231510],
      [6.9815462, 51.3230988],
      [6.9815905, 51.3231145],
      [6.9816297, 51.3231249],
      [6.9816773, 51.3231111],
      [6.9817283, 51.3231084],
      [6.9817679, 51.3231074],
      [6.9817888, 51.3230888],
      [6.9818205, 51.3230918],
      [6.9818414, 51.3231072],
      [6.9818816, 51.3231147],
      [6.9819107, 51.3231341],
      [6.9819329, 51.3231335],
      [6.9819399, 51.3231342],
      [6.9820028, 51.3231554],
      [6.9820327, 51.3231341],
      [6.9820636, 51.3231357],
      [6.9820662, 51.3231437],
      [6.9820927, 51.3231411],
      [6.9821371, 51.3231193],
      [6.9821634, 51.3230728],
      [6.9821903, 51.3230682],
      [6.9822236, 51.3230641],
      [6.9822654, 51.3230628],
      [6.9823176, 51.3230666],
      [6.9823709, 51.3230862],
      [6.9824073, 51.3230883],
      [6.9824256, 51.3230770],
      [6.9824603, 51.3231077],
      [6.9824881, 51.3230993],
      [6.9825096, 51.3230768],
      [6.9825369, 51.3230999],
      [6.9825831, 51.3231068],
      [6.9826312, 51.3231336],
      [6.9826721, 51.3231593],
      [6.9827016, 51.3231790],
      [6.9827461, 51.3231958],
      [6.9827823, 51.3231850],
      [6.9828237, 51.3231932],
      [6.9828552, 51.3231942],
      [6.9828896, 51.3231916],
      [6.9829226, 51.3231949],
      [6.9829536, 51.3231959],
      [6.9829910, 51.3231984],
      [6.9830261, 51.3231966],
      [6.9830638, 51.3232026],
      [6.9830974, 51.3232069],
      [6.9831348, 51.3232183],
      [6.9831656, 51.3232154],
      [6.9831991, 51.3232222],
      [6.9832210, 51.3232290],
      [6.9832666, 51.3232350],
      [6.9832697, 51.3232398],
      [6.9832785, 51.3232488],
      [6.9833220, 51.3232586],
      [6.9833550, 51.3232599],
      [6.9833939, 51.3232507],
      [6.9834262, 51.3232338],
      [6.9834588, 51.3232317],
      [6.9834915, 51.3232069],
      [6.9835178, 51.3231913],
      [6.9835469, 51.3231859],
      [6.9835817, 51.3231751],
      [6.9836365, 51.3231579],
      [6.9836708, 51.3231443],
      [6.9837058, 51.3231414],
      [6.9837353, 51.3231499],
      [6.9837590, 51.3231654],
      [6.9837911, 51.3231628],
      [6.9838180, 51.3231820],
      [6.9838506, 51.3231888],
      [6.9838836, 51.3232015],
      [6.9839235, 51.3231930],
      [6.9839615, 51.3231996],
      [6.9839972, 51.3231894],
      [6.9840342, 51.3232014],
      [6.9840700, 51.3232106],
      [6.9841040, 51.3232153],
      [6.9841480, 51.3232055],
      [6.9841835, 51.3232020],
      [6.9842225, 51.3231990],
      [6.9842626, 51.3231601],
      [6.9843007, 51.3231493],
      [6.9843330, 51.3231437],
      [6.9843707, 51.3231371],
      [6.9844128, 51.3231324],
      [6.9844461, 51.3231316],
      [6.9844754, 51.3231314],
      [6.9845087, 51.3231346],
      [6.9845389, 51.3231352],
      [6.9845746, 51.3231322],
      [6.9846111, 51.3231247],
      [6.9846500, 51.3231334],
      [6.9846858, 51.3231308],
      [6.9847225, 51.3231224],
      [6.9847564, 51.3231195],
      [6.9847910, 51.3231200],
      [6.9848287, 51.3231141],
      [6.9848644, 51.3231141],
      [6.9848935, 51.3231134],
      [6.9849275, 51.3231139],
      [6.9849649, 51.3231145],
      [6.9849967, 51.3231127],
      [6.9850342, 51.3231139],
      [6.9850724, 51.3231126],
      [6.9851039, 51.3231127],
      [6.9851408, 51.3231164],
      [6.9851764, 51.3231183],
      [6.9852122, 51.3231239],
      [6.9852429, 51.3231277],
      [6.9852746, 51.3231297],
      [6.9853107, 51.3231340],
      [6.9853376, 51.3231352],
      [6.9853693, 51.3231402],
      [6.9854006, 51.3231463],
      [6.9854379, 51.3231504],
      [6.9854724, 51.3231534],
      [6.9855013, 51.3231650],
      [6.9855355, 51.3231724],
      [6.9855694, 51.3231795],
      [6.9855980, 51.3231918],
      [6.9856363, 51.3232015],
      [6.9856682, 51.3232083],
      [6.9857044, 51.3232167],
      [6.9857446, 51.3232251],
      [6.9857901, 51.3232367],
      [6.9858291, 51.3232464],
      [6.9858646, 51.3232558],
      [6.9858935, 51.3232648],
      [6.9859138, 51.3232696],
      [6.9859353, 51.3232539],
      [6.9859435, 51.3232254],
      [6.9859451, 51.3232033],
      [6.9859488, 51.3231864],
      [6.9859571, 51.3231656],
      [6.9859562, 51.3231526],
      [6.9859514, 51.3231291],
      [6.9859511, 51.3231054],
      [6.9859533, 51.3230810],
      [6.9859479, 51.3230738],
      [6.9859444, 51.3230511],
      [6.9859489, 51.3230336],
      [6.9859635, 51.3230190],
      [6.9859820, 51.3230198],
      [6.9860198, 51.3230201],
      [6.9860590, 51.3230197],
      [6.9860983, 51.3230041],
      [6.9861399, 51.3230020],
      [6.9861807, 51.3230014],
      [6.9862120, 51.3229982],
      [6.9862358, 51.3229966],
      [6.9862745, 51.3229983],
      [6.9863090, 51.3230002],
      [6.9863483, 51.3230008],
      [6.9863510, 51.3229901],
      [6.9863964, 51.3229899],
      [6.9864356, 51.3229882],
      [6.9864745, 51.3229924],
      [6.9865148, 51.3229939],
      [6.9865481, 51.3229947],
      [6.9865943, 51.3229875],
      [6.9866362, 51.3229873],
      [6.9866760, 51.3229819],
      [6.9867147, 51.3229821],
      [6.9867626, 51.3229827],
      [6.9868036, 51.3229838],
      [6.9868383, 51.3229852],
      [6.9868772, 51.3229851],
      [6.9869203, 51.3229820],
      [6.9869500, 51.3229803],
      [6.9869852, 51.3229704],
      [6.9870114, 51.3229515],
      [6.9870378, 51.3229366],
      [6.9870723, 51.3229339],
      [6.9871061, 51.3229327],
      [6.9871429, 51.3229285],
      [6.9871774, 51.3229265],
      [6.9872139, 51.3229280],
      [6.9872505, 51.3229309],
      [6.9872796, 51.3229320],
      [6.9873133, 51.3229326],
      [6.9873482, 51.3229225],
      [6.9873703, 51.3229168],
      [6.9873804, 51.3229033],
      [6.9873842, 51.3228784],
      [6.9873954, 51.3228561],
      [6.9873988, 51.3228411],
      [6.9873953, 51.3228243],
      [6.9874064, 51.3228119],
      [6.9874356, 51.3227930],
      [6.9874501, 51.3227739],
      [6.9874504, 51.3227649],
      [6.9874625, 51.3227607],
      [6.9874764, 51.3227548],
      [6.9874818, 51.3227540],
      [6.9875039, 51.3227466],
      [6.9875090, 51.3227515],
      [6.9875021, 51.3227569],
      [6.9874597, 51.3227386],
      [6.9874612, 51.3227228],
      [6.9874516, 51.3227267],
      [6.9874549, 51.3227286],
      [6.9874532, 51.3227339],
      [6.9874520, 51.3227311],
      [6.9874523, 51.3227331],
      [6.9874505, 51.3227410],
      [6.9874169, 51.3227615],
      [6.9874609, 51.3227466],
      [6.9874419, 51.3227631],
      [6.9873583, 51.3227922],
      [6.9873415, 51.3228244],
      [6.9873450, 51.3228219],
      [6.9872059, 51.3228881],
      [6.9871680, 51.3229445],
      [6.9871717, 51.3229725],
      [6.9870966, 51.3230335],
      [6.9872215, 51.3230355],
      [6.9873428, 51.3229747],
      [6.9873688, 51.3229775],
      [6.9874527, 51.3229939],
      [6.9874529, 51.3230628],
      [6.9874633, 51.3230684],
      [6.9875420, 51.3231207],
      [6.9876262, 51.3231207]
    ];

    // Wertearrays (1..6)
    const heigth = [4,4,5,5,4,4,4,4,4,4,4,4,4,4,3,3,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
      6,6,6,6,6,6,6,6,6,6,6,6,5,5,6,6,5,5,5,6,6,6,5,5,5,5,5,5,5,5,5,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,5,4,4,4,4,5,4,4,4,4,4,
      4,4,4,4,3,3,4,4,4,4,3,3,3,3,3,4,3,3,4,4,4,4,4,4,4,4,4,3,4,4,4,4,4,3,3,3,3,3,3,4,4,4,4,4,4,4,3,4,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
      4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,2,2,2,2,1,1,1];

    const heigthDiff = ['0 - 54','54 - 108','108 - 162','162 - 216','216 - 270','270 - 324'];

    const time = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]()
